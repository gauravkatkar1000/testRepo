# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'fci_04_batch_issues_submenu.ui'
#
# Created by: PyQt5 UI code generator 5.15.0
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

from fci_03b_weighing_storage_batch import fci_03b_Ui_MainWindow
from fci_03i_weighing_storage_issues import fci_03i_Ui_MainWindow
from fci_03_weighing import fci_03_Ui_MainWindow
from fci_34_weighing_others import fci_34_Ui_MainWindow

from PyQt5 import QtCore, QtGui, QtWidgets
import datetime
import time
import sqlite3
from PyQt5.QtCore import QRegExp
from PyQt5.QtGui import QRegExpValidator
import re
import os,sys
import serial,time



class fci_04_Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(1368, 768)
        MainWindow.setBaseSize(QtCore.QSize(0, 0))
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.frame = QtWidgets.QFrame(self.centralwidget)
        self.frame.setGeometry(QtCore.QRect(25, 25, 1311, 718))
        self.frame.setFrameShape(QtWidgets.QFrame.StyledPanel)
        self.frame.setFrameShadow(QtWidgets.QFrame.Raised)
        self.frame.setStyleSheet("background-color: rgb(47, 141, 255);")
        self.frame.setObjectName("frame")
        self.pushButton = QtWidgets.QPushButton(self.frame)
        self.pushButton.setGeometry(QtCore.QRect(150, 450, 211, 71))
        #self.pushButton.setStyleSheet("color: rgb(255, 255, 0);")
        font = QtGui.QFont()
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(75)
        self.pushButton.setFont(font)
        self.pushButton.setStyleSheet("background-color: rgb(255, 200, 158); color: rgb(255, 0, 0);")
        self.pushButton.setObjectName("pushButton")
        self.label_20 = QtWidgets.QLabel(self.frame)
        self.label_20.setGeometry(QtCore.QRect(1080, 10, 225, 31))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setPointSize(14)
        font.setBold(True)
        font.setUnderline(False)
        font.setWeight(50)
        self.label_20.setFont(font)
        self.label_20.setStyleSheet("color: rgb(255, 255, 255);")
        self.label_20.setAlignment(QtCore.Qt.AlignCenter)
        self.label_20.setObjectName("label_20")
        self.pushButton_2 = QtWidgets.QPushButton(self.frame)
        self.pushButton_2.setGeometry(QtCore.QRect(610, 590, 101, 31))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(50)
        self.pushButton_2.setFont(font)       
        self.pushButton_2.setObjectName("pushButton_2")
        self.pushButton_3 = QtWidgets.QPushButton(self.frame)
        self.pushButton_3.setGeometry(QtCore.QRect(440, 450, 211, 71))
        self.pushButton_3.setStyleSheet("background-color: rgb(255, 200, 158);color: rgb(212, 0, 255);")
        font = QtGui.QFont()
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(75)
        self.pushButton_3.setFont(font)
        self.pushButton_3.setObjectName("pushButton_3")
        self.pushButton_4 = QtWidgets.QPushButton(self.frame)
        self.pushButton_4.setGeometry(QtCore.QRect(730, 450, 211, 71))
        self.pushButton_4.setStyleSheet("background-color: rgb(255, 200, 158); color: rgb(0, 180, 0);")
        font = QtGui.QFont()
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(75)
        self.pushButton_4.setFont(font)
        self.pushButton_4.setObjectName("pushButton_4")
        self.pushButton_5 = QtWidgets.QPushButton(self.frame)
        self.pushButton_5.setGeometry(QtCore.QRect(1020, 450, 211, 71))
        self.pushButton_5.setStyleSheet("background-color: rgb(255, 200, 158); color: rgb(0, 0, 255);")
        font = QtGui.QFont()
        font.setPointSize(14)
        font.setBold(True)
        font.setWeight(75)
        self.pushButton_5.setFont(font)
        self.pushButton_5.setObjectName("pushButton_5")
        self.lcdNumber = QtWidgets.QLCDNumber(self.frame)
        self.lcdNumber.setGeometry(QtCore.QRect(270, 90, 761, 251))
        self.lcdNumber.setLayoutDirection(QtCore.Qt.LeftToRight)
        self.lcdNumber.setStyleSheet("background-color: rgb(0, 0, 0);\n"
"font: 10pt \"MS Sans Serif\";\n"
"color: rgb(255, 0, 0);")
        self.lcdNumber.setProperty("value", 20000)
        self.lcdNumber.setObjectName("lcdNumber")
        self.label_53 = QtWidgets.QLabel(self.frame)
        self.label_53.setGeometry(QtCore.QRect(1040, 270, 81, 91))
        font = QtGui.QFont()
        font.setFamily("MS Shell Dlg 2")
        font.setPointSize(24)
        font.setBold(True)
        font.setUnderline(False)
        font.setWeight(75)
        self.label_53.setFont(font)
        self.label_53.setStyleSheet("")
        self.label_53.setAlignment(QtCore.Qt.AlignLeading|QtCore.Qt.AlignLeft|QtCore.Qt.AlignVCenter)
        self.label_53.setObjectName("label_53")
        MainWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(MainWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 1368, 21))
        self.menubar.setObjectName("menubar")
        MainWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(MainWindow)
        self.statusbar.setObjectName("statusbar")
        MainWindow.setStatusBar(self.statusbar)
        self.device_location_type=""
        self.current_value=0
        self.line =""
        self.IO_error_flg=0
        self.xstr3=""
        self.xstr2=""
        self.xstr4=""

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.pushButton.setText(_translate("MainWindow", "ZERO"))
        self.label_20.setText(_translate("MainWindow", "05 Aug 2020 12:45:00"))
        self.pushButton_2.setText(_translate("MainWindow", "RETURN"))
        self.pushButton_3.setText(_translate("MainWindow", "RECIPT"))
        self.pushButton_4.setText(_translate("MainWindow", "ISSUE"))
        self.pushButton_5.setText(_translate("MainWindow", "OTHER"))
        self.label_53.setText(_translate("MainWindow", ".Kg"))
        self.pushButton_2.clicked.connect(MainWindow.close)
        
        self.timer2=QtCore.QTimer()
        self.timer1=QtCore.QTimer()
        self.timer1.setInterval(1000)        
        self.timer1.timeout.connect(self.device_date)
        self.timer1.start(1)
        
        connection = sqlite3.connect("fci.db")
        results=connection.execute("SELECT DEVICE_LOCATION_TYPE  FROM GLOBAL_VAR") 
        for x in results:            
            self.device_location_type=str(x[0])
        connection.close()
        
        if(self.device_location_type == "SITE"):
            self.pushButton_3.clicked.connect(self.open_new_window6)
            self.pushButton_4.setDisabled(True)
        else:
            self.pushButton_3.clicked.connect(self.open_new_window4)
            self.pushButton_4.clicked.connect(self.open_new_window5)
            
        self.pushButton_5.clicked.connect(self.open_new_window7)
        self.start_wt()
        
    def device_date(self):     
        self.label_20.setText(datetime.datetime.now().strftime("%d %b %Y %H:%M:%S"))

    
    def start_wt(self):
        #print("Weight Started ....")
        try:
            self.ser = serial.Serial(
                                port='/dev/ttyUSB0',
                                baudrate=9600,
                                bytesize=serial.EIGHTBITS,
                                parity=serial.PARITY_NONE,
                                stopbits=serial.STOPBITS_ONE,
                                xonxoff=False,
                                timeout = 0.05
                            )
        
            self.ser.flush()       
            
            self.line = self.ser.readline(15)
            print("o/p:"+str(self.line))
             
            self.timer2.setInterval(5000)        
            self.timer2.timeout.connect(self.display_lcd_val)
            self.timer2.start(1)
            
            
        except IOError:
            print("IO Errors-load cell connections error")
            self.IO_error_flg=1
            
            
    def display_lcd_val(self):               
        #print(" inside display_lcd_val:"+str(self.IO_error_flg))
        if(self.IO_error_flg==0):
            try:
                self.line = self.ser.readline(20)
                print(" raw o/p:"+str(self.line)) 
                if (len(self.line) > 2):
                    
                    self.ser.flush()
                    self.ser.write(b'*D\r')
                    self.xstr3=str(self.line,'utf-8')
                    self.xstr2=self.xstr3[0:6]
                    #print("self.xstr3:"+str(self.xstr3)+" self.xstr2: "+str(self.xstr2))
                    try:
                         self.xstr4=int(self.xstr2)
                    except ValueError:                        
                        print("Value Error"+str(self.xstr2))
                        self.xstr4=0                    
                    try:
                        self.current_value=float(int(self.xstr4)/1000)
                    except ValueError:
                        print("Value Error :"+str(self.xstr4))
                        self.xstr4=0
                        self.current_value=0                    
                    self.lcdNumber.setProperty("value", str(self.xstr4))                    
                    
            except IOError:
                print("IO Errors : Data Read Error") 
                self.IO_error_flg=1  
    
    
    
    
    
    
    
    
    
    
    
    def open_new_window4(self):       
        self.window = QtWidgets.QMainWindow()
        self.ui=fci_03b_Ui_MainWindow()
        self.ui.setupUi(self.window)           
        self.window.show()     
    
    def open_new_window5(self):       
        self.window = QtWidgets.QMainWindow()
        self.ui=fci_03i_Ui_MainWindow()
        self.ui.setupUi(self.window)           
        self.window.show()
        
    def open_new_window6(self):       
        self.window = QtWidgets.QMainWindow()
        self.ui=fci_03_Ui_MainWindow()
        self.ui.setupUi(self.window)           
        self.window.show()
        
    def open_new_window7(self):       
        self.window = QtWidgets.QMainWindow()
        self.ui=fci_34_Ui_MainWindow()
        self.ui.setupUi(self.window)           
        self.window.show()   


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = fci_04_Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
